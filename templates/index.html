<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Habit Tracker 9000</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Hybrid Chain Tracker</h1>
        <a href="{{ url_for('add_habit') }}" class="btn" style="margin-bottom: 20px;">+ Add New Habit</a>

        {% for habit in habits %}
        <div class="habit-row">
            <div class="habit-info">
                <h2>{{ habit.name}}</h2>
                <p>Streak: {{ habit.streak}} days</p>

                <div class="log-controls">
            
                    {% if habit.type == 'binary' %}
                        {% if habit.is_completed %}
                            <button class="btn btn-disabled" disabled>Completed!</button>
                        {% else %}
                            <form action="{{ url_for('log_progress', habit_id=habit.id) }}" method="POST">
                                <input type="hidden" name="amount" value="{{ habit.target }}">
                                <button type="submit" class="btn btn-checkin">Check In</button>
                            </form>
                        {% endif %}
                    
                    {% elif habit.type == 'progressive' %}
                        <div class="prog-status">
                            <small>{{ habit.today_value|int }} / {{ habit.target|int }} {{ habit.unit }}</small>
                        </div>
                        
                        <form action="{{ url_for('log_progress', habit_id=habit.id) }}" method="POST" class="prog-form">
                            <input type="number" name="amount" step="any" placeholder="+ Add" required>
                            <button type="submit" class="btn btn-small">+</button>
                        </form>

                    {% elif habit.type == 'vice'%}
                        {% if habit.is_completed %}
                            <button class="btn btn-vice-disabled" disabled>Shield Active</button>
                        {% else %}
                            <form action="{{ url_for('log_progress', habit_id=habit.id) }}" method="POST">
                                <input type="hidden" name="amount" value="1">
                                <button type="submit" class="btn btn-vice">Deflect Vice</button>
                            </form>
                        {% endif %}
                    {% endif %}
            
                </div>
            </div>

            <div class="chain-container">
                {% if habit.type == 'binary'%}
                    <div class="node binary-node {{ 'completed' if habit.is_completed else ''}}">
                        <span class="streak-num">{{ habit.streak }}</span>
                    </div>
                {% elif habit.type == 'progressive' %}
                    <div class="node progressive-node">
                        <svg width="60" height="60" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" stroke="#ddd" stroke-width="10" fill="none"/>
                            <circle cx="50" cy="50" r="45" stroke="{{ habit.color }}" stroke-width="10" fill="none"
                                    stroke-dasharray="283"
                                    stroke-dashoffset="{{ 283 - (283 * habit.fill_percent / 100) }}"
                                    transform="rotate(-90 50 50)"/>
                        </svg>
                        <span class="streak-num">{{ habit.streak }}</span>
                    </div>
                {% elif habit.type == 'vice' %}
                    <div class="vice-container">
                        <div class="shield {{ habit.shield_material }} {{ 'active' if habit.is_completed else '' }}">
                            <svg width="80" height="90" viewBox="0 0 100 120">
                                <path class="shield-shape" d="M50 115 C20 100 0 70 0 30 L50 0 L100 30 C100 70 80 100 50 115 Z" />
                                <path class="shield-glint" d="M50 10 C80 30 90 60 50 105 C10 60 20 30 50 10 Z" fill="rgba(255,255,255,0.2)"/>
                            </svg>
                            
                            <span class="shield-streak">{{ habit.streak }}</span>
                        </div>
    
                        <div class="deflection-zone"></div>
                    </div>
                {% endif %}

                {% if habit.is_completed %}
                    <div class="link-connector active"></div>
                {% else %}
                    <div class="link-connector"></div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</body>
</html>